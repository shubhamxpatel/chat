(this.webpackJsonpchatroom=this.webpackJsonpchatroom||[]).push([[0],{53:function(e,t,n){},86:function(e,t,n){},94:function(e,t,n){"use strict";n.r(t);var o=n(1),c=n.n(o),i=n(45),s=n.n(i),a=(n(53),n(47)),l=n(2),r=n(26),d=n(7),u=n.n(d),m=n(15),f=n(46),p=n.n(f),g=n(0),h=p()("https://spvideoapp.herokuapp.com",{transports:["websocket"]}),y=[],b=function(e){var t,n=new Audio("https://dl.prokerala.com/downloads/ringtones/files/mp3/bell-4836.mp3");function c(e){e&&e.getTracks().forEach((function(e){e.stop()}))}console.log(n),n.volume=.04;var i={},s=[],a={front:1,back:0},l={};console.log(y);var d,f={iceServers:[{url:"stun:stun.l.google.com:19302"},{url:"turn:3.143.222.94.3478",credential:"root",username:"user"}]},p="";function b(e){try{console.log("connection close"),document.getElementById("receiver").childNodes.forEach((function(t){t.value===e&&t.parentNode.removeChild(t)})),console.log(document.getElementById(e)),document.getElementById(e).parentNode.parentNode.removeChild(document.getElementById(e).parentNode),i[e].close(),s=s.filter((function(t){return t!==e})),console.log("connection close"),delete i[e]}catch(t){}}function v(e){d.getTracks().forEach((function(t){t.kind===e&&t.stop()})),console.log(d.getTracks()),d.getTracks().forEach((function(e){s.forEach((function(t){i[t].getSenders().forEach((function(t){t.track.type===e.type&&t.replaceTrack(e)}))}))})),document.getElementById("self").srcObject=d}function x(e){var t={};t[e]=!0,navigator.mediaDevices.getUserMedia(t).then((function(e){e.getTracks().forEach((function(e){d.getTracks().forEach((function(t){e.kind===t.kind&&(console.log(e.kind),d.removeTrack(t),d.addTrack(e))}))}))})).then((function(){console.log(d.getTracks()),d.getTracks().forEach((function(e){s.forEach((function(t){i[t].getSenders().forEach((function(t){t.track.type===e.type&&t.replaceTrack(e)}))}))})),document.getElementById("self").srcObject=d}))}function j(e){var t=new MediaStream;function n(e,t){var n=new Uint8Array(l[t][0].size),o=l[t][0].type;l[t].sort((function(e,t){return e.seq>t.seq?1:-1}));var c=0,i=0;l[t].forEach((function(e){if(e.seq===c){for(var o in e.file)n[i]=e.file[o],i++;c++}else delete l[t]}));var s=URL.createObjectURL(new Blob([n],{type:o}));delete l[t];var a=document.createElement("p");a.style.color="green",a.style.width="90%",a.style.marginLeft="1%",a.style.marginTop="2px",a.style.textAlign="left",a.style.padding="5px",a.style.backgroundColor="wheat",a.style.borderRadius="10px",console.log("added at receive file function"),a.innerHTML="<strong>By ".concat(e,":</strong><br><a href=").concat(s," download=").concat(t.split("$$$")[0],">").concat(t.split("$$$")[0],"</a>"),document.getElementById("commentbox").appendChild(a),document.getElementById("commentbox").scrollTop=document.getElementById("commentbox").scrollHeight-document.getElementById("commentbox").offsetHeight}i[e]=new RTCPeerConnection(f),i[e].dc=i[e].createDataChannel("signal"),d.getTracks().forEach((function(t){i[e].addTrack(t,d)})),i[e].onicecandidate=function(t){t.candidate&&h.emit("icecandidate",{candidate:t.candidate,to:e})},i[e].ondatachannel=function(t){console.log("channel event",t.channel),i[e].dc=t.channel},console.log(i[e].ondatachannel,i[e].dc),i[e].dc.onopen=function(){console.log("channel is open");var n=document.createElement("video");n.id=e,n.controls=!0,n.autoplay=!0,n.muted=!0;var o=document.createElement("div"),c=document.createElement("button");c.innerHTML='<i class="fa fa-times fontawesome" aria-hidden="true"></i>',c.style.visibility="hidden",o.style.position="relative",c.style.padding="5px",c.style.left="50%",c.style.top="0",c.style.transform="translateX(-50%)",c.style.backgroundColor="transparent",n.style.zIndex="-1",c.onclick=function(){console.log(e),b(e)},n.onclick=n.onpointerdown=function(){console.log("onclick event"),"hidden"==c.style.visibility?(c.style.visibility="visible",setTimeout((function(){c.style.visibility="hidden"}),3e3)):c.style.visibility="hidden"},c.style.position="absolute",c.style.zIndex="100",n.style.width="100%",o.classList.add("col-lg-2","col-md-3","col-sm-4","col-6"),i[e].play=1,i[e].full=0,n.srcObject=t,o.appendChild(n),o.appendChild(c),s.push(e),document.getElementById("div1").appendChild(o),i[e].onnegotiationneeded=function(t){console.log("event negotiation neede"),E(e)};var a=document.createElement("option");a.value=e,a.innerText=e,document.getElementById("receiver").appendChild(a)},i[e].dc.onclose=function(t){b(e)},i[e].dc.onmessage=function(t){try{var o=JSON.parse(t.data);l[o.name]?(l[o.name].push(o),200===o.status&&n(e,o.name)):(l[o.name]=[],l[o.name].push(o),200===o.status&&n(e,o.name))}catch(i){var c=document.createElement("p");c.style.color="green",c.style.width="90%",c.style.marginLeft="1%",c.style.marginTop="2px",c.style.textAlign="left",c.style.padding="5px",c.style.backgroundColor="wheat",c.style.borderRadius="10px",c.innerHTML="<strong>By ".concat(e,":</strong><br>").concat(t.data),document.getElementById("commentbox").appendChild(c),document.getElementById("commentbox").scrollTop=document.getElementById("commentbox").scrollHeight-document.getElementById("commentbox").offsetHeight}},i[e].ontrack=function(e){console.log(e.track),t.addTrack(e.track,t)},console.log(i[e],e)}function E(e){return k.apply(this,arguments)}function k(){return(k=Object(m.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i[t].createOffer();case 2:return n=e.sent,e.next=5,i[t].setLocalDescription(n);case 5:console.log(n,t),h.emit("makeCall",{offer:n,to:t});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return O.apply(this,arguments)}function O(){return(O=Object(m.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i[t].createAnswer();case 2:return n=e.sent,console.log(n),e.next=6,i[t].setLocalDescription(n);case 6:h.emit("respondcall",{answer:n,to:t});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(){c(d),navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:!0}).then((function(e){a.back&&(a.back=0,a.front=1),d=e,e.getTracks().forEach((function(e){s.forEach((function(t){i[t].getSenders().forEach((function(t){t.track.type===e.type&&t.replaceTrack(e)}))})),document.getElementById("self").srcObject=d}))})).catch((function(e){delete a.back,B()}))}function B(){c(d),navigator.mediaDevices.getUserMedia({video:{facingMode:{exact:"environment"}},audio:!0}).then((function(e){a.front&&(a.back=1,a.front=0),d=e,e.getTracks().forEach((function(e){s.forEach((function(t){i[t].getSenders().forEach((function(t){t.track.type===e.type&&t.replaceTrack(e)}))}))})),document.getElementById("self").srcObject=d})).catch((function(e){console.log("back camera not working"),delete a.back,console.log(a),I()}))}function C(){if(""!==document.getElementById("send").value.trim()){""===document.getElementById("receiver").value?s.forEach((function(e){i[e].dc.send(document.getElementById("send").value)})):i[document.getElementById("receiver").value].dc.send(document.getElementById("send").value);var e=document.createElement("p");e.style.color="red",e.style.width="90%",e.style.textAlign="left",e.style.marginLeft="9%",e.style.marginTop="2px",e.style.padding="5px",e.style.backgroundColor="wheat",e.style.borderRadius="10px",e.innerHTML="<strong>To ".concat(document.getElementById("receiver").value,": </strong><br>").concat(document.getElementById("send").value),document.getElementById("commentbox").appendChild(e),document.getElementById("commentbox").scrollTop=document.getElementById("commentbox").scrollHeight-document.getElementById("commentbox").offsetHeight,document.getElementById("send").value=""}}return Object(o.useEffect)((function(){document.getElementById("div1").style.height="".concat(document.body.offsetHeight-document.getElementById("box").offsetHeight,"px"),document.getElementById("switchaudio").onclick=function(){var e=document.getElementById("switchaudio");if(console.log(e),e.childNodes[0].classList.toString().includes("fa-microphone-slash"))try{v("audio"),e.childNodes[0].classList.remove("fa-microphone-slash"),e.childNodes[0].classList.add("fa-microphone")}catch(t){}else try{x("audio"),e.childNodes[0].classList.remove("fa-microphone"),e.childNodes[0].classList.add("fa-microphone-slash")}catch(t){}},document.getElementById("switchvideo").onclick=function(){var e=document.getElementById("switchvideo");if(e.childNodes[0].classList.toString().includes("fa-video-slash"))try{v("video"),e.childNodes[0].classList.remove("fa-video-slash"),e.childNodes[0].classList.add("fa-video")}catch(t){}else try{x("video"),e.childNodes[0].classList.remove("fa-video"),e.childNodes[0].classList.add("fa-video-slash")}catch(t){}},navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){d=e,console.log(d),document.getElementById("self").srcObject=d}))}),[]),window.onunload=window.onbeforeunload=function(){for(var e in i)b(e)},h.on("create_connection",(function(e){if(i[e])console.log(i[e]);else if(y.includes(e)||(console.log("caller is not present"),y.push(e)),y.length>0){n.play(),document.getElementById("idnum").innerText=y[0];var t=document.getElementById("callerdisplay");console.log("incoming call",e),t.style.visibility="visible",t.style.height="fit-content",p=y[0]}})),h.on("user disconnected",(function(e){console.log("user "+e+" disconnected"),i[e]&&b(e)})),h.on("setice",function(){var e=Object(m.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i[t.to]){e.next=10;break}if(!t.iceCandidate){e.next=10;break}return e.prev=2,e.next=5,i[t.to].addIceCandidate(t.iceCandidate);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.error("Error adding received ice candidate",e.t0);case 10:case"end":return e.stop()}}),e,null,[[2,7]])})));return function(t){return e.apply(this,arguments)}}()),h.on("answer",function(){var e=Object(m.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i[t.to]){e.next=11;break}return e.prev=1,n=new RTCSessionDescription(t.answer),e.next=5,i[t.to].setRemoteDescription(n);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.log(e.t0);case 10:console.log("call answered");case 11:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}()),h.on("offer",function(){var e=Object(m.a)(u.a.mark((function e(t){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i[t.to]){e.next=4;break}return e.next=3,i[t.to].setRemoteDescription(new RTCSessionDescription(t.offer));case 3:w(t.to);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),window.onresize=function(){document.getElementById("div1").style.height="".concat(document.body.offsetHeight-document.getElementById("box").offsetHeight,"px")},Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)("center",{}),Object(g.jsxs)("div",{className:"box",style:{boxShadow:"1px 1px 10px 1px whitesmoke"},id:"box",children:[Object(g.jsx)("div",{style:{padding:"10px"},children:Object(g.jsxs)("center",{children:[Object(g.jsxs)("form",{onSubmit:function(){p=document.getElementById("t").value,console.log("make call request by ",p),i[p]||(j(p),h.emit("create_connection",p))},method:"dialog",className:"form-inline",children:[Object(g.jsx)("input",{type:"text",name:"t",id:"t",required:!0,placeholder:"enter receiver id"}),Object(g.jsxs)("div",{className:"btn-group",children:[Object(g.jsx)("input",{className:"btn-sm btn-primary",type:"submit",value:"submit"}),Object(g.jsx)("div",{style:{margin:"0",borderRadius:"50%",width:"40px",height:"40px",position:"relative"},className:"btn btn-success","data-toggle":"tooltip",title:"copy your id",onClick:function(){var e=h.id,t=document.createElement("input");t.type="text",t.value=e,document.body.appendChild(t),t.select(),t.focus(),document.execCommand("copy"),t.parentNode.removeChild(t)},children:Object(g.jsx)("i",{style:{fontSize:"150%",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"whitesmoke",backgroundColor:"transparent"},class:"fas fa-clone"})})]})]}),Object(g.jsxs)("div",{id:"btns",children:[Object(g.jsx)("button",{style:{margin:"5px",borderRadius:"50%",width:"40px",height:"40px",position:"relative"},className:"btn btn-danger",onClick:function(){"mediaDevices"in navigator&&"getDisplayMedia"in navigator.mediaDevices?navigator.mediaDevices.getDisplayMedia({video:!0,audio:!0}).then((function(e){var t=document.createElement("p");t.innerText="sharescreen supported",document.body.appendChild(t),e.getTracks().forEach((function(e){s.forEach((function(t){i[t].getSenders().forEach((function(t){t.track.type===e.type&&t.replaceTrack(e)}))}))}))})).catch((function(){})):document.getElementById("chg1").parentNode.removeChild(document.getElementById("chg1"))},"data-toggle":"tooltip",title:"present screen",children:Object(g.jsx)("i",{style:{fontSize:"150%",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"whitesmoke",backgroundColor:"transparent"},class:"fas fa-desktop"})}),Object(g.jsx)("button",{style:{margin:"5px",borderRadius:"50%",width:"40px",height:"40px",position:"relative"},className:"btn btn-danger",onClick:function(){if(console.log(a),"front"in a&&"back"in a){if(1===a.front&&0===a.back)return void B();if(0===a.front&&1===a.back)return void I()}},"data-toggle":"tooltip",title:"switch camera",children:Object(g.jsx)("i",{style:{fontSize:"150%",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"whitesmoke",backgroundColor:"transparent"},class:"fas fa-sync"})}),Object(g.jsx)("button",{style:{margin:"5px",borderRadius:"50%",width:"40px",height:"40px",position:"relative"},className:"btn btn-danger",id:"switchaudio",children:Object(g.jsx)("i",{style:{fontSize:"150%",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"whitesmoke",backgroundColor:"transparent"},class:"fas fa-microphone-slash"})}),Object(g.jsx)("button",{style:{margin:"5px",borderRadius:"50%",width:"40px",height:"40px",position:"relative"},className:"btn btn-danger",id:"switchvideo",children:Object(g.jsx)("i",{style:{fontSize:"150%",position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",color:"whitesmoke",backgroundColor:"transparent"},class:"fas fa-video-slash"})})]})]})}),Object(g.jsx)("div",{style:{display:"grid",placeItems:"center"},children:Object(g.jsx)("video",{src:"",style:{width:"60%"},id:"self",autoPlay:!0,muted:!0})})]}),Object(g.jsx)("div",{id:"div1",className:"col-12",style:{display:"flex",flexWrap:"wrap",overflowY:"scroll"}}),Object(g.jsxs)("div",{id:"div2",className:"m-fadeOut",style:{width:"98vw",position:"absolute",left:"50%",transform:"translateX(-50%)",bottom:"5px",zIndex:"100"},children:[Object(g.jsx)("div",{id:"commentbox",style:{position:"relative",width:"100%",height:"40vh",backgroundColor:"whitesmoke",marginLeft:"50%",transform:"translateX(-50%)",overflowY:"scroll"}}),Object(g.jsx)("center",{children:Object(g.jsxs)("div",{style:{width:"100%",heigth:"70px",padding:"0",position:"relative"},children:[Object(g.jsxs)("div",{style:{position:"absolute",left:"0",top:"-100%",transform:"translateY(100%)"},className:"btn-group-sm",children:[Object(g.jsx)("button",{className:"btn-sm btn-primary hovers",onClick:function(){document.getElementById("send").style.visibility="visible",document.getElementById("fileform").style.visibility="hidden"},children:"text"}),Object(g.jsx)("button",{className:"btn-sm btn-danger hovers",onClick:function(){document.getElementById("send").style.visibility="hidden",document.getElementById("fileform").style.visibility="visible"},children:"file"}),Object(g.jsx)("select",(t={className:"hovers","data-toggle":"tooltip",title:"select receiver",style:{position:"absolute",left:"5px",bottom:"5px",width:"30px"},name:"receiver",id:"receiver"},Object(r.a)(t,"style",{padding:"3px"}),Object(r.a)(t,"children",Object(g.jsx)("option",{value:"",children:"All"})),t))]}),Object(g.jsx)("textarea",{style:{width:"100%",height:"67px",visibility:"visible"},id:"send",placeholder:"write message and press enter to send!",onKeyPress:function(e){13===e.which&&(console.log(e.which),C())}}),Object(g.jsx)("div",{id:"fileform",style:{visibility:"hidden",position:"absolute",top:"0",left:"0",width:"100%",backgroundColor:"gray"},children:Object(g.jsx)("form",{className:"form-inline",onSubmit:function(){var e=document.getElementById("file").files[0];console.log("File is ".concat([e.name,e.size,e.type,e.lastModified].join(" ")));var t="".concat(e.name,"$$$").concat(new Date),n=0,o=[];""===document.getElementById("receiver").value?o=s:o.push(document.getElementById("receiver").value);var c=[],a=new FileReader,l=0,r=document.createElement("p");r.style.color="red",r.style.width="90%",r.style.textAlign="left",r.style.marginLeft="9%",r.style.marginTop="2px",r.style.padding="5px",r.style.backgroundColor="wheat",r.style.borderRadius="10px",r.innerHTML="<strong>To ".concat(document.getElementById("receiver").value,": </strong><br><a  download=").concat(e.name,">").concat(e.name,"</a>");var d=document.createElement("div");d.style.width="0%",d.style.height="6px",d.style.backgroundColor="red",r.appendChild(d),document.getElementById("commentbox").appendChild(r),document.getElementById("commentbox").scrollTop=document.getElementById("commentbox").scrollHeight-document.getElementById("commentbox").offsetHeight,document.getElementById("file").value="",a.addEventListener("error",(function(e){return console.error("Error reading file:",e)})),a.addEventListener("abort",(function(e){return console.log("File reading aborted:",e)})),a.addEventListener("load",(function(s){var a={name:t,seq:n,status:206,file:new Uint8Array(s.target.result),size:e.size};l+s.target.result.byteLength>=e.size&&(a.status=200),c.push(s.target.result);var m=JSON.stringify(a);if(o.forEach((function(e){i[e].dc.send(m)})),(l+=s.target.result.byteLength)<e.size)n++,d.style.width="".concat(l/e.size*100,"%"),setTimeout((function(){u(l)}),50);else{var f=URL.createObjectURL(new Blob(c));r.childNodes[0].href=f,r.childNodes[0].download=e.name,d.style.width="100%"}}));var u=function(t){var n=e.slice(l,t+16200);a.readAsArrayBuffer(n)};u(0)},method:"dialog",children:Object(g.jsxs)("div",{className:"form-group",children:[Object(g.jsx)("input",{type:"file",name:"file",id:"file",required:!0}),Object(g.jsx)("input",{className:"btn-sm btn-success",type:"submit",value:"sendfile"})]})})})]})})]}),Object(g.jsx)("div",{children:Object(g.jsxs)("div",{id:"callerdisplay",style:{position:"absolute",borderRadius:"10px",padding:"5px",backgroundColor:"gray",width:"fit-content",left:"50%",top:"4%",transform:"translate(-50%,0)",border:"2px solid black",boxShadow:"-5px -5px 8px 5px red",overflow:"hidden",height:"0",visibility:"hidden",zIndex:"100"},children:[Object(g.jsx)("p",{style:{textAlign:"center"},id:"idnum"}),Object(g.jsxs)("div",{style:{display:"flex",justifyContent:"space-around"},children:[Object(g.jsxs)("figure",{onClick:function(){if(p=document.getElementById("idnum").innerText,0===(y=y.filter((function(e){return e!==p}))).length){var e=document.getElementById("callerdisplay");e.style.visibility="hidden",e.style.height="0px",n.pause()}else document.getElementById("idnum").innerText=y[0];j(p),console.log(p),E(p)},children:[Object(g.jsx)("img",{src:"https://png.pngitem.com/pimgs/s/207-2074671_free-green-phone-icon-hd-png-download.png",style:{borderRadius:"50%"},height:"50",width:"50",alt:""}),Object(g.jsx)("figcaption",{children:"Receive"})]}),Object(g.jsxs)("figure",{onClick:function(){if(p=document.getElementById("idnum").innerText,0===(y=y.filter((function(e){return e!==p}))).length){var e=document.getElementById("callerdisplay");e.style.visibility="hidden",e.style.height="0px",n.pause()}else document.getElementById("idnum").innerText=y[0];n.pause(),p=""},children:[Object(g.jsx)("img",{src:"https://image.shutterstock.com/image-vector/decline-phone-call-button-handset-260nw-1141358105.jpg",style:{borderRadius:"50%"},height:"50",width:"50",alt:""}),Object(g.jsx)("figcaption",{children:"Ignore"})]})]})]})}),Object(g.jsx)("button",{onClick:function(){var e=document.getElementById("up");document.getElementById("div2").classList.toggle("m-fadeOut"),document.getElementById("div2").classList.toggle("m-fadeIn"),e.classList.toString().includes("fa-chevron-circle-up")?(e.classList.remove("fa-chevron-circle-up"),e.classList.add("fa-chevron-circle-down")):(e.classList.remove("fa-chevron-circle-down"),e.classList.add("fa-chevron-circle-up"))},className:"btn btn-primary hovers",style:{position:"absolute",bottom:"10px",right:"10px",zIndex:"100"},children:Object(g.jsx)("i",{id:"up",style:{fontSize:"30px"},class:"fa fa-chevron-circle-up","data-toggle":"tooltip",title:"open message panel","aria-hidden":"true"})})]})},v=(n(86),function(){return Object(g.jsx)(a.a,{basename:"/chat",children:Object(g.jsxs)(l.d,{children:[Object(g.jsx)(l.b,{exact:!0,path:"/",component:b}),Object(g.jsx)(l.b,{default:!0,children:Object(g.jsx)(l.a,{to:"/"})})]})})}),x=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,95)).then((function(t){var n=t.getCLS,o=t.getFID,c=t.getFCP,i=t.getLCP,s=t.getTTFB;n(e),o(e),c(e),i(e),s(e)}))};s.a.render(Object(g.jsx)(c.a.StrictMode,{children:Object(g.jsx)(v,{})}),document.getElementById("root")),x()}},[[94,1,2]]]);
//# sourceMappingURL=main.73b91f7f.chunk.js.map